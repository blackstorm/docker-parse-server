services:
  database:
    image: mongo:6.0.5
    environment:
      MONGO_INITDB_ROOT_USERNAME: admin
      MONGO_INITDB_ROOT_PASSWORD: admin
    volumes:
      - ./volumes/database:/data/db
  server:
    image: parseplatform/parse-server:6.1.0
    depends_on:
      - database
    # prefer restarting only when failing to avoid restarts with clean exits
    restart: on-failure
    environment:
      - PARSE_SERVER_APPLICATION_ID=abc
      - PARSE_SERVER_APPLICATION_NAME=mini-ticket
      - PARSE_SERVER_MASTER_KEY=masterkey
      - PARSE_SERVER_DATABASE_URI=mongodb://admin:admin@database/parse_server?authSource=admin
      # TODO: substitue with a working parse server url
      # - PARSE_SERVER_URL=http://10.0.2.2:1337/parse
      - PARSE_SERVER_MOUNT_GRAPHQL=true
    volumes:
      - ./volumes/server:/data/server
  dashboard:
    image: parseplatform/parse-dashboard:5.1.0
    environment:
      - PARSE_DASHBOARD_MASTER_KEY=masterkey
      - PARSE_DASHBOARD_APP_ID=abc
      - PARSE_DASHBOARD_APP_NAME=mini-ticket
      - PARSE_DASHBOARD_USER_ID=admin
      - PARSE_DASHBOARD_USER_PASSWORD=admin
      - PARSE_DASHBOARD_SERVER_URL="http://server:1337/parse"
    depends_on:
      - server
